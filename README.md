## OwlsTelemetry — обзор проекта (Vibe)

OwlsTelemetry — комплекс из плагина Paper/Spigot для Minecraft 1.20.6, серверного backend’а на Spring Boot и нового веб-дэшборда на React/Vite. Цель комплекса — собирать и визуализировать телеметрию игрового сервера (онлайн, сессии, команды, чат, PvP, отчёты и т.п.).


- **Плагин `src/main/java/me/owlsTelemetry`**
  - Реагирует на события Paper (join/quit, команды, чат, PvP, критические события).
  - Отправляет данные в backend через `WebApiClient` (HTTP + JSON, ключ доступа в заголовке `X-OwlsTelemetry-Key`).
  - Содержит анти-флуд/анти-краш механику (`CrashExploitDetector`), настраиваемую через `config.yml`.
  - Логирование снижено до уровня debug; включён троттлинг и повтор запросов к API.

- **Backend `OtSite/backend` (Spring Boot 3 + JPA)**
  - REST API (`/api/...`) с защитой фильтром `ApiSecurityFilter`.
  - Авторизация сайта: POST `/api/auth/access` с ключом доступа ⇒ JWT.
  - Авторизация плагина: все `/api/plugin/*` запросы требуют заголовок с ключом.
  - Сервисы:
    - `StatsService` — агрегированные метрики: текущий онлайн, средняя активность по часам/дням, топ команд, топ игроков, свежие убийства.
    - `PlayerAnalyticsService` — аналитика по игроку, перерасчёт сессий, автозакрытие зависших сессий, обновление профилей и статистики.
    - `ReportService` — генерация отчётов (JSON) по серверу или конкретному игроку, хранение 7 дней.
  - Планировщики (`@EnableScheduling`):
    - `PlayerStatusScheduler` — закрытие неактивных сессий каждые 2 минуты.
    - `ReportService.cleanupExpiredReports()` — удаление просроченных отчётов.
  - Хранилище (по умолчанию H2 файл `OtSite/backend/data/owlstelemetry.*`). Можно переключить на PostgreSQL/MySQL при необходимости.

- **Frontend `OtSite/frontend` (Vite + React + TypeScript + TailwindCSS)**
  - UI/UX с современным тёмным оформлением, адаптивной сеткой и плавными переходами.
  - Роуты:
    - `/login` — вход по ключу, получение JWT.
    - `/` — дашборд (онлайн, графики по времени, топы, лента PvP).
    - `/players` — список игроков с поиском и основными метриками.
    - `/players/:uuid` — аналитика игрока (графики, журналы команд/чата/сессий, PvP).
    - `/reports` — генерация/загрузка отчётов JSON (сервер/игрок).
  - API слой (`src/api/client.ts` + хуки) оборачивает запросы и рефрешится через `AuthProvider`.
  - Используются `Recharts` для интерактивных графиков, `HeadlessUI/Heroicons` для визуальных элементов.

### Ключевые возможности

- Рефакторинг плагина, устранение NPE, снижение спама логов, гибкий монитор памяти, отправка эксплойтов даже при отключённой БД.
- Защищённая авторизация сайта и плагина, ключ доступа вынесен в конфиги (`config.yml`, `application.yml`).
- Новые API:
  - `/api/stats/dashboard`, `/api/stats/activity/*`, `/api/stats/commands/top`, `/api/stats/players/top`.
  - `/api/players/{uuid}/analytics` — агрегированная аналитика игрока.
  - `/api/reports/*` — создание/загрузка отчётов (JSON, TTL 7 дней).
- Серверные и индивидуальные отчёты содержат профили, сессии, команды, чат, PvP-метрики за выбранный период.
- Автоочистка устаревших отчётов и зависших сессий.
- Новый дашборд с графиками (активность по часам/дням, последние убийства, топ команд/игроков).
- Раздел игрока с интерактивной аналитикой и журналами.
